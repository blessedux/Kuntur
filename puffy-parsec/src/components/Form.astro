---
import { Image } from 'astro:assets'
---

<!-- Include FontAwesome CDN -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
/>

<script src="/scripts/form.js" defer></script>
<script>
  // Price mapping based on origin and destination
  const priceMapping = {
    'Punta Arenas': {
      'Puerto Natales': 336000,
      'Aeropuerto Puq': 35000,
      Ushuaia: 1035000,
      Calafate: 885000,
      'Fuerte Bulnes': 98000,
      'City tour Puq': 60000,
      'Reserva Magallanes': 75000
    },
    Ushuaia: {
      'Punta Arenas': 1035000,
      Calafate: 885000
      // Add other reverse routes if needed
    },
    Calafate: {
      'Punta Arenas': 885000,
      Ushuaia: 885000 // Assuming same price for reverse
      // Add other reverse routes if needed
    },
    'Puerto Natales': {
      'Punta Arenas': 336000
      // Add other reverse routes if needed
    },
    'Fuerte Bulnes': {
      'Punta Arenas': 98000
      // Add other reverse routes if needed
    },
    'Aeropuerto Puq': {
      'Punta Arenas': 35000
      // Add other reverse routes if needed
    },
    'City tour Puq': {
      'Punta Arenas': 60000
      // Add other reverse routes if needed
    },
    'Reserva Magallanes': {
      'Punta Arenas': 75000
      // Add other reverse routes if needed
    }
  }

  // List of valid destinations for matching
  const validDestinations = Object.keys(priceMapping['Punta Arenas']).concat(
    Object.keys(priceMapping['Ushuaia']),
    Object.keys(priceMapping['Calafate']),
    Object.keys(priceMapping['Puerto Natales']),
    Object.keys(priceMapping['Fuerte Bulnes']),
    Object.keys(priceMapping['Aeropuerto Puq']),
    Object.keys(priceMapping['City tour Puq']),
    Object.keys(priceMapping['Reserva Magallanes'])
  )

  // Function to update the price display
  function updatePrice() {
    const origin = document.getElementById('origin').value
    let destination = document.getElementById('destination').value
    const priceDisplay = document.getElementById('priceDisplay')

    // Suggest closest valid destination
    if (validDestinations.includes(origin)) {
      const matchedDestination = validDestinations.find(dest =>
        dest.toLowerCase().startsWith(destination.toLowerCase())
      )
      if (matchedDestination) {
        destination = matchedDestination // Update destination to the matched one
        document.getElementById('destination').value = matchedDestination // Auto-fill the input
      }
    }

    if (priceMapping[origin] && priceMapping[origin][destination]) {
      const price = priceMapping[origin][destination]
      priceDisplay.textContent = `Precio estimado: $${price.toLocaleString()} CLP`
      document.getElementById('paxInfo').textContent = '1-4 pax'
    } else {
      priceDisplay.textContent = 'Selecciona un origen y un destino válidos.'
      document.getElementById('paxInfo').textContent = '' // Clear pax info if invalid
    }
  }

  // Add event listeners to update price on input change
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('origin').addEventListener('input', updatePrice)
    document
      .getElementById('destination')
      .addEventListener('input', updatePrice)
  })
</script>

<section
  class="py-12 bg-cover bg-center bg-fixed flex flex-col justify-center items-center z-20 min-h-screen px-4"
  style="background-image: url('form-background-paine.webp');"
>
  <!-- Title Outside Form -->
  <div class="text-center mb-8">
    <h2 class="text-4xl font-regular text-black-500 leading-tight">
      ¿Listo para <br />una nueva <br />
      <span class="font-serif italic">aventura?</span>
    </h2>
    <p class="text-xl text-black-600 mt-2">Reserva ahora tu próximo viaje.</p>
  </div>

  <!-- Form Wrapper with Margin & White Background -->
  <div class="w-full max-w-sm my-12 bg-white p-8 rounded-3xl shadow-xl">
    <!-- Form -->
    <form id="reservationForm" class="space-y-4">
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700"
          >Nombre</label
        >
        <input
          type="text"
          id="name"
          name="name"
          class="w-full border rounded-full p-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Tu nombre"
          required
        />
      </div>
      <div>
        <label for="origin" class="block text-sm font-medium text-gray-700"
          >Origen</label
        >
        <input
          type="text"
          id="origin"
          name="origin"
          class="w-full border rounded-full p-3 text-gray-700 focus:outline-none"
          placeholder="Punta Arenas"
          required
        />
      </div>
      <div>
        <label for="destination" class="block text-sm font-medium text-gray-700"
          >Destino</label
        >
        <input
          type="text"
          id="destination"
          name="destination"
          class="w-full border rounded-full p-3 text-gray-700 focus:outline-none"
          placeholder="Ushuaia"
          required
        />
      </div>
      <div>
        <label for="date" class="block text-sm font-medium text-gray-700"
          >Fecha del viaje</label
        >
        <input
          id="date"
          type="date"
          class="w-full border rounded-md p-2 focus:ring focus:ring-blue-200"
          required
        />
      </div>

      <!-- Price Display -->
      <div
        id="priceDisplay"
        class="text-sm font-light text-gray-600 mt-4 bg-gray-200 p-2 rounded-md w-1/1 float-right flex justify-between items-center"
      >
        <span>Precio estimado: $0 CLP</span>
      </div>
      <div id="paxInfo" class="text-xs text-gray-500 mt-1 flex items-center">
        <i class="fas fa-user-friends h-4 w-4 mr-1"></i>
        <!-- FontAwesome passenger icon -->
        <span>1-4 pax</span>
      </div>

      <button
        type="submit"
        class="w-full bg-black text-white py-3 rounded-full hover:bg-gray-800 transition"
      >
        Reserva tu transporte
      </button>
    </form>
  </div>

  <!-- Centered Logo Below Form -->
  <div class="mt-6">
    <Image
      src="/Kuntur_logo.png"
      alt="Company Logo"
      width={150}
      height={50}
      class="h-12 mx-auto"
    />
  </div>
</section>
